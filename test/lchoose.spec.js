var chai = require('chai');
var expect = chai.expect;
var precision = 1e-12;
var main = require('..');
var utils = require('../panthrMath/utils');

/* Rcode generating the tests:
   options(digits = 20)
   n = c(-3, -2, -1, -1.01, 1:10, 40:42)
   k = c(1:15, -2, 2.4)
   ks = rep(k, each = length(n))
   ns = rep(n, length(k))
   ns = signif(ns, digits=7)
   ks = signif(ks, digits=7)
   lchs = lchoose(ns, ks)
   chs = choose(ns, ks)
   ns = formatC(ns, digits=7, format="g")
   ks = formatC(ks, digits=7, format="g")
   lchs = formatC(lchs, digits=15, format="g")
   chs = formatC(chs, digits=15, format="g")
   s = paste(ns, ks, lchs, chs, sep=", ", collapse="],\n[")
   s = paste("[", s, "]", sep="")
 */

describe('lchoose and choose functions', function() {
   it('work', function() {
      [
[      -3,        1, 1.09861228866811,               -3],
[      -2,        1, 0.693147180559945,               -2],
[      -1,        1,                0,               -1],
[   -1.01,        1, 0.00995033085316809,            -1.01],
[       1,        1,                0,                1],
[       2,        1, 0.693147180559945,                2],
[       3,        1, 1.09861228866811,                3],
[       4,        1, 1.38629436111989,                4],
[       5,        1,  1.6094379124341,                5],
[       6,        1, 1.79175946922805,                6],
[       7,        1, 1.94591014905531,                7],
[       8,        1, 2.07944154167984,                8],
[       9,        1, 2.19722457733622,                9],
[      10,        1, 2.30258509299405,               10],
[      40,        1, 3.68887945411394,               40],
[      41,        1, 3.71357206670431,               41],
[      42,        1, 3.73766961828337,               42],
[      -3,        2, 1.79175946922806,                6],
[      -2,        2, 1.09861228866811,                3],
[      -1,        2,                0,                1],
[   -1.01,        2, 0.0149378723642071,          1.01505],
[       1,        2,        -Infinity,                0],
[       2,        2,                0,                1],
[       3,        2, 1.09861228866811,                3],
[       4,        2, 1.79175946922806,                6],
[       5,        2, 2.30258509299405,               10],
[       6,        2, 2.70805020110221,               15],
[       7,        2, 3.04452243772342,               21],
[       8,        2,  3.3322045101752,               28],
[       9,        2, 3.58351893845611,               36],
[      10,        2, 3.80666248977032,               45],
[      40,        2, 6.65929391968364,              780],
[      41,        2,  6.7093043402583,              820],
[      42,        2, 6.75809450442773,              861],
[      -3,        3, 2.30258509299405,              -10],
[      -2,        3, 1.38629436111989,               -4],
[      -1,        3,                0,               -1],
[   -1.01,        3, 0.0182656624568815,       -1.0184335],
[       1,        3,        -Infinity,                0],
[       2,        3,        -Infinity,                0],
[       3,        3,                0,                1],
[       4,        3, 1.38629436111989,                4],
[       5,        3, 2.30258509299405,               10],
[       6,        3, 2.99573227355399,               20],
[       7,        3, 3.55534806148941,               35],
[       8,        3, 4.02535169073515,               56],
[       9,        3, 4.43081679884331,               84],
[      10,        3, 4.78749174278205,              120],
[      40,        3, 9.19826779074191,             9880],
[      41,        3, 9.27425369771984,            10660],
[      42,        3, 9.34836166987356,            11480],
[      -3,        4, 2.70805020110221,               15],
[      -2,        4,  1.6094379124341,                5],
[      -1,        4,                0,                1],
[   -1.01,        4, 0.0207625426554687,    1.02097958375],
[       1,        4,        -Infinity,                0],
[       2,        4,        -Infinity,                0],
[       3,        4,        -Infinity,                0],
[       4,        4,                0,                1],
[       5,        4,  1.6094379124341,                5],
[       6,        4, 2.70805020110221,               15],
[       7,        4, 3.55534806148941,               35],
[       8,        4, 4.24849524204936,               70],
[       9,        4, 4.83628190695148,              126],
[      10,        4, 5.34710753071747,              210],
[      40,        4, 11.4228913422662,            91390],
[      41,        4, 11.5255454963263,           101270],
[      42,        4, 11.6256289548833,           111930],
[      -3,        5, 3.04452243772342,              -21],
[      -2,        5, 1.79175946922805,               -6],
[      -1,        5,                0,               -1],
[   -1.01,        5, 0.0227605453181416, -1.0230215429175],
[       1,        5,        -Infinity,                0],
[       2,        5,        -Infinity,                0],
[       3,        5,        -Infinity,                0],
[       4,        5,        -Infinity,                0],
[       5,        5,                0,                1],
[       6,        5, 1.79175946922805,                6],
[       7,        5, 3.04452243772342,               21],
[       8,        5, 4.02535169073515,               56],
[       9,        5, 4.83628190695148,              126],
[      10,        5, 5.52942908751142,              252],
[      40,        5, 13.3969723682883,           658008],
[      41,        5, 13.5270254965365,           749398],
[      42,        5, 13.6537772021756,           850668],
[      -3,        6,  3.3322045101752,               28],
[      -2,        6, 1.94591014905531,                7],
[      -1,        6,                0,                1],
[   -1.01,        6, 0.0244258246372029, 1.02472657882236],
[       1,        6,        -Infinity,                0],
[       2,        6,        -Infinity,                0],
[       3,        6,        -Infinity,                0],
[       4,        6,        -Infinity,                0],
[       5,        6,        -Infinity,                0],
[       6,        6,                0,                1],
[       7,        6, 1.94591014905531,                7],
[       8,        6,  3.3322045101752,               28],
[       9,        6, 4.43081679884331,               84],
[      10,        6, 5.34710753071747,              210],
[      40,        6, 15.1605609605496,          3838380],
[      41,        6, 15.3187849657645,          4496388],
[      42,        6, 15.4729356455918,          5245786],
[      -3,        7, 3.58351893845611,              -36],
[      -2,        7, 2.07944154167984,               -8],
[      -1,        7,                0,               -1],
[   -1.01,        7, 0.0258533766283886, -1.02619047393497],
[       1,        7,        -Infinity,                0],
[       2,        7,        -Infinity,                0],
[       3,        7,        -Infinity,                0],
[       4,        7,        -Infinity,                0],
[       5,        7,        -Infinity,                0],
[       6,        7,        -Infinity,                0],
[       7,        7,                0,                1],
[       8,        7, 2.07944154167984,                8],
[       9,        7, 3.58351893845611,               36],
[      10,        7, 4.78749174278205,              120],
[      40,        7, 16.7410113361105,         18643560],
[      41,        7, 16.9282228781986,         22481940],
[      42,        7, 17.1105444349926,         26978328],
[      -3,        8, 3.80666248977032,               45],
[      -2,        8, 2.19722457733622,                9],
[      -1,        8,                0,                1],
[   -1.01,        8, 0.027102596028818, 1.02747321202738],
[       1,        8,        -Infinity,                0],
[       2,        8,        -Infinity,                0],
[       3,        8,        -Infinity,                0],
[       4,        8,        -Infinity,                0],
[       5,        8,        -Infinity,                0],
[       6,        8,        -Infinity,                0],
[       7,        8,        -Infinity,                0],
[       8,        8,                0,                1],
[       9,        8, 2.19722457733622,                9],
[      10,        8, 3.80666248977032,               45],
[      40,        8, 18.1580773558971,         76904685],
[      41,        8, 18.3751418611349,         95548245],
[      42,        8, 18.5864509548021,        118030185],
[      -3,        9, 4.00733318523247,              -55],
[      -2,        9, 2.30258509299405,              -10],
[      -1,        9,                0,               -1],
[   -1.01,        9, 0.0282130903128475, -1.02861484892964],
[       1,        9,        -Infinity,                0],
[       2,        9,        -Infinity,                0],
[       3,        9,        -Infinity,                0],
[       4,        9,        -Infinity,                0],
[       5,        9,        -Infinity,                0],
[       6,        9,        -Infinity,                0],
[       7,        9,        -Infinity,                0],
[       8,        9,        -Infinity,                0],
[       9,        9,                0,                1],
[      10,        9, 2.30258509299405,               10],
[      40,        9, 19.4265886813606,        273438880],
[      41,        9, 19.6744248452652,        350343565],
[      42,        9, 19.9155869020821,        445891810],
[      -3,       10, 4.18965474202643,               66],
[      -2,       10, 2.39789527279837,               11],
[      -1,       10,                0,                1],
[   -1.01,       10, 0.0292125906459306, 1.02964346377857],
[       1,       10,        -Infinity,                0],
[       2,       10,        -Infinity,                0],
[       3,       10,        -Infinity,                0],
[       4,       10,        -Infinity,                0],
[       5,       10,        -Infinity,                0],
[       6,       10,        -Infinity,                0],
[       7,       10,        -Infinity,                0],
[       8,       10,        -Infinity,                0],
[       9,       10,        -Infinity,                0],
[      10,       10,                0,                1],
[      40,       10, 20.5579907928517,        847660528],
[      41,       10, 20.8375756550709,       1121099408],
[      42,       10, 21.1095093705545,       1471442973],
[      -3,       11, 4.35670882668959,              -78],
[      -2,       11,   2.484906649788,              -12],
[      -1,       11,                0,               -1],
[   -1.01,       11, 0.0301212685821488, -1.03057950329109],
[       1,       11,        -Infinity,                0],
[       2,       11,        -Infinity,                0],
[       3,       11,        -Infinity,                0],
[       4,       11,        -Infinity,                0],
[       5,       11,        -Infinity,                0],
[       6,       11,        -Infinity,                0],
[       7,       11,        -Infinity,                0],
[       8,       11,        -Infinity,                0],
[       9,       11,        -Infinity,                0],
[      10,       11,        -Infinity,                0],
[      40,       11, 21.5612929017155,       2311801440],
[      41,       11, 21.8736675867577,       3159461968],
[      42,       11, 22.1773500005559,       4280561376],
[      -3,       12, 4.51085950651685,               91],
[      -2,       12, 2.56494935746154,               13],
[      -1,       12,                0,                1],
[   -1.01,       12, 0.0309542548860406, 1.03143831954384],
[       1,       12,        -Infinity,                0],
[       2,       12,        -Infinity,                0],
[       3,       12,        -Infinity,                0],
[       4,       12,        -Infinity,                0],
[       5,       12,        -Infinity,                0],
[       6,       12,        -Infinity,                0],
[       7,       12,        -Infinity,                0],
[       8,       12,        -Infinity,                0],
[       9,       12,        -Infinity,                0],
[      10,       12,        -Infinity,                0],
[      40,       12,  22.443682081914,       5586853480],
[      41,       12, 22.7899583186318,       7898654920],
[      42,       12,  23.126430555253,      11058116888],
[      -3,       13, 4.65396035015752,             -105],
[      -2,       13, 2.63905732961526,              -14],
[      -1,       13,                0,               -1],
[   -1.01,       13, 0.0317231899489174, -1.03223173363579],
[       1,       13,        -Infinity,                0],
[       2,       13,        -Infinity,                0],
[       3,       13,        -Infinity,                0],
[       4,       13,        -Infinity,                0],
[       5,       13,        -Infinity,                0],
[       6,       13,        -Infinity,                0],
[       7,       13,        -Infinity,                0],
[       8,       13,        -Infinity,                0],
[       9,       13,        -Infinity,                0],
[      10,       13,        -Infinity,                0],
[      40,       13, 23.2109372346276,      12033222880],
[      41,       13, 23.5923047911567,      17620076360],
[      42,       13, 23.9626785794536,      25518731280],
[      -3,       14, 4.78749174278204,              120],
[      -2,       14, 2.70805020110221,               15],
[      -1,       14,                0,                1],
[   -1.01,       14, 0.0324372206825747, 1.03296904201696],
[       1,       14,        -Infinity,                0],
[       2,       14,        -Infinity,                0],
[       3,       14,        -Infinity,                0],
[       4,       14,        -Infinity,                0],
[       5,       14,        -Infinity,                0],
[       6,       14,        -Infinity,                0],
[       7,       14,        -Infinity,                0],
[       8,       14,        -Infinity,                0],
[       9,       14,        -Infinity,                0],
[      10,       14,        -Infinity,                0],
[      40,       14, 23.8677167710167,      23206929840],
[      41,       14, 24.2854519717167,      35240152720],
[      42,       14, 24.6909170798249,      52860229080],
[      -3,       15, 4.91265488573605,             -136],
[      -2,       15, 2.77258872223978,              -16],
[      -1,       15,                0,               -1],
[   -1.01,       15, 0.0331036652257408, -1.03365768804497],
[       1,       15,        -Infinity,                0],
[       2,       15,        -Infinity,                0],
[       3,       15,        -Infinity,                0],
[       4,       15,        -Infinity,                0],
[       5,       15,        -Infinity,                0],
[       6,       15,        -Infinity,                0],
[       7,       15,        -Infinity,                0],
[       8,       15,        -Infinity,                0],
[       9,       15,        -Infinity,                0],
[      10,       15,        -Infinity,                0],
[      40,       15,  24.417763107936,      40225345056],
[      41,       15, 24.8732386366188,      63432274896],
[      42,       15, 25.3150713888978,      98672427616],
[      -3,       -2,        -Infinity,                0],
[      -2,       -2,        -Infinity,                0],
[      -1,       -2,        -Infinity,                0],
[   -1.01,       -2,        -Infinity,                0],
[       1,       -2,        -Infinity,                0],
[       2,       -2,        -Infinity,                0],
[       3,       -2,        -Infinity,                0],
[       4,       -2,        -Infinity,                0],
[       5,       -2,        -Infinity,                0],
[       6,       -2,        -Infinity,                0],
[       7,       -2,        -Infinity,                0],
[       8,       -2,        -Infinity,                0],
[       9,       -2,        -Infinity,                0],
[      10,       -2,        -Infinity,                0],
[      40,       -2,        -Infinity,                0],
[      41,       -2,        -Infinity,                0],
[      42,       -2,        -Infinity,                0],
[      -3,      2.4, 1.79175946922806,                6],
[      -2,      2.4, 1.09861228866811,                3],
[      -1,      2.4,                0,                1],
[   -1.01,      2.4, 0.0149378723642071,          1.01505],
[       1,      2.4,        -Infinity,                0],
[       2,      2.4,                0,                1],
[       3,      2.4, 1.09861228866811,                3],
[       4,      2.4, 1.79175946922806,                6],
[       5,      2.4, 2.30258509299405,               10],
[       6,      2.4, 2.70805020110221,               15],
[       7,      2.4, 3.04452243772342,               21],
[       8,      2.4,  3.3322045101752,               28],
[       9,      2.4, 3.58351893845611,               36],
[      10,      2.4, 3.80666248977032,               45],
[      40,      2.4, 6.65929391968364,              780],
[      41,      2.4,  6.7093043402583,              820],
[      42,      2.4, 6.75809450442773,              861]
      ].forEach(function(tuple) {
      expect(utils.relativelyCloseTo(main.lchoose(tuple[0], tuple[1]), tuple[2], precision)).to.be.ok;
      expect(utils.relativelyCloseTo(main.choose(tuple[0], tuple[1]), tuple[3], precision)).to.be.ok;
      });
   });
});
