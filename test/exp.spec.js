var main = require('..');
var chai = require('chai');
var expect = chai.expect;
var utils = require('../panthrMath/utils');

var precision = 1e-8;

   /* Rcode generating the tests:
      options(digits = 20)
      x = 0.5 * exp(-6:4)
      a = exp(-6:6)
      as = rep(a, each = length(x))
      xs = rep(x, length(a))
      xs2 = signif(xs, digits=15)
      as2 = signif(as, digits=15)

      exps2 = dexp(xs2, as2, log = TRUE)
      ps2 = pexp(xs2, as2, lower.tail = TRUE, log.p=TRUE)
      qs2 = pexp(xs2, as2, lower.tail = FALSE, log.p=TRUE)
      xs2 = formatC(xs2, digits=15, format="g")
      as2 = formatC(as2, digits=15, format="g")
      ps2 = formatC(ps2, digits=15, format="g")
      qs2 = formatC(qs2, digits=15, format="g")

      s = paste(xs2, as2, exps2, sep=", ", collapse="],\n[")
      s = paste("[", s, "]", sep="")

      s2 = paste(xs2, as2, ps2, qs2, sep=", ", collapse="],\n[")
      s2 = paste("[", s2, "]", sep="")
    */
describe('Exponential Distribution', function() {
   it('dexp', function() {
      [
      [0.00123937608833318, 0.00247875217666636, -6.00000307210618],
      [0.00336897349954273, 0.00247875217666636, -6.00000835085039],
      [0.00915781944436709, 0.00247875217666636, -6.00002269996488],
      [0.024893534183932, 0.00247875217666636, -6.00006170490204],
      [0.0676676416183064, 0.00247875217666636, -6.00016773131395],
      [0.183939720585721, 0.00247875217666636, -6.00045594098278],
      [             0.5, 0.00247875217666636, -6.00123937608833],
      [1.35914091422952, 0.00247875217666636, -6.00336897349954],
      [3.69452804946532, 0.00247875217666636, -6.00915781944437],
      [10.0427684615938, 0.00247875217666636, -6.02489353418393],
      [27.2990750165721, 0.00247875217666636, -6.06766764161831],
      [0.00123937608833318, 0.00673794699908547, -5.0000083508504],
      [0.00336897349954273, 0.00673794699908547, -5.00002269996488],
      [0.00915781944436709, 0.00673794699908547, -5.00006170490204],
      [0.024893534183932, 0.00673794699908547, -5.00016773131395],
      [0.0676676416183064, 0.00673794699908547, -5.00045594098278],
      [0.183939720585721, 0.00673794699908547, -5.00123937608833],
      [             0.5, 0.00673794699908547, -5.00336897349954],
      [1.35914091422952, 0.00673794699908547, -5.00915781944437],
      [3.69452804946532, 0.00673794699908547, -5.02489353418393],
      [10.0427684615938, 0.00673794699908547, -5.06766764161831],
      [27.2990750165721, 0.00673794699908547, -5.18393972058572],
      [0.00123937608833318, 0.0183156388887342, -4.00002269996488],
      [0.00336897349954273, 0.0183156388887342, -4.00006170490204],
      [0.00915781944436709, 0.0183156388887342, -4.00016773131395],
      [0.024893534183932, 0.0183156388887342, -4.00045594098278],
      [0.0676676416183064, 0.0183156388887342, -4.00123937608833],
      [0.183939720585721, 0.0183156388887342, -4.00336897349954],
      [             0.5, 0.0183156388887342, -4.00915781944437],
      [1.35914091422952, 0.0183156388887342, -4.02489353418393],
      [3.69452804946532, 0.0183156388887342, -4.06766764161831],
      [10.0427684615938, 0.0183156388887342, -4.18393972058572],
      [27.2990750165721, 0.0183156388887342, -4.5],
      [0.00123937608833318, 0.0497870683678639, -3.00006170490204],
      [0.00336897349954273, 0.0497870683678639, -3.00016773131395],
      [0.00915781944436709, 0.0497870683678639, -3.00045594098278],
      [0.024893534183932, 0.0497870683678639, -3.00123937608833],
      [0.0676676416183064, 0.0497870683678639, -3.00336897349954],
      [0.183939720585721, 0.0497870683678639, -3.00915781944437],
      [             0.5, 0.0497870683678639, -3.02489353418393],
      [1.35914091422952, 0.0497870683678639, -3.06766764161831],
      [3.69452804946532, 0.0497870683678639, -3.18393972058572],
      [10.0427684615938, 0.0497870683678639, -3.5],
      [27.2990750165721, 0.0497870683678639, -4.35914091422952],
      [0.00123937608833318, 0.135335283236613, -2.00016773131395],
      [0.00336897349954273, 0.135335283236613, -2.00045594098277],
      [0.00915781944436709, 0.135335283236613, -2.00123937608833],
      [0.024893534183932, 0.135335283236613, -2.00336897349954],
      [0.0676676416183064, 0.135335283236613, -2.00915781944436],
      [0.183939720585721, 0.135335283236613, -2.02489353418393],
      [             0.5, 0.135335283236613, -2.0676676416183],
      [1.35914091422952, 0.135335283236613, -2.18393972058572],
      [3.69452804946532, 0.135335283236613, -2.5],
      [10.0427684615938, 0.135335283236613, -3.35914091422952],
      [27.2990750165721, 0.135335283236613, -5.69452804946533],
      [0.00123937608833318, 0.367879441171442, -1.00045594098278],
      [0.00336897349954273, 0.367879441171442, -1.00123937608833],
      [0.00915781944436709, 0.367879441171442, -1.00336897349954],
      [0.024893534183932, 0.367879441171442, -1.00915781944437],
      [0.0676676416183064, 0.367879441171442, -1.02489353418393],
      [0.183939720585721, 0.367879441171442, -1.06766764161831],
      [             0.5, 0.367879441171442, -1.18393972058572],
      [1.35914091422952, 0.367879441171442, -1.5],
      [3.69452804946532, 0.367879441171442, -2.35914091422952],
      [10.0427684615938, 0.367879441171442, -4.69452804946531],
      [27.2990750165721, 0.367879441171442, -11.0427684615938],
      [0.00123937608833318,                1, -0.00123937608833318],
      [0.00336897349954273,                1, -0.00336897349954273],
      [0.00915781944436709,                1, -0.00915781944436709],
      [0.024893534183932,                1, -0.024893534183932],
      [0.0676676416183064,                1, -0.0676676416183064],
      [0.183939720585721,                1, -0.183939720585721],
      [             0.5,                1, -0.5],
      [1.35914091422952,                1, -1.35914091422952],
      [3.69452804946532,                1, -3.69452804946532],
      [10.0427684615938,                1, -10.0427684615938],
      [27.2990750165721,                1, -27.2990750165721],
      [0.00123937608833318, 2.71828182845904, 0.996631026500455],
      [0.00336897349954273, 2.71828182845904, 0.990842180555631],
      [0.00915781944436709, 2.71828182845904, 0.975106465816066],
      [0.024893534183932, 2.71828182845904, 0.932332358381692],
      [0.0676676416183064, 2.71828182845904, 0.816060279414277],
      [0.183939720585721, 2.71828182845904, 0.499999999999999],
      [             0.5, 2.71828182845904, -0.359140914229522],
      [1.35914091422952, 2.71828182845904, -2.69452804946531],
      [3.69452804946532, 2.71828182845904, -9.0427684615938],
      [10.0427684615938, 2.71828182845904, -26.299075016572],
      [27.2990750165721, 2.71828182845904, -73.2065795512881],
      [0.00123937608833318, 7.38905609893065, 1.99084218055563],
      [0.00336897349954273, 7.38905609893065, 1.97510646581607],
      [0.00915781944436709, 7.38905609893065, 1.93233235838169],
      [0.024893534183932, 7.38905609893065, 1.81606027941428],
      [0.0676676416183064, 7.38905609893065, 1.5],
      [0.183939720585721, 7.38905609893065, 0.640859085770479],
      [             0.5, 7.38905609893065, -1.69452804946532],
      [1.35914091422952, 7.38905609893065, -8.04276846159381],
      [3.69452804946532, 7.38905609893065, -25.2990750165721],
      [10.0427684615938, 7.38905609893065, -72.206579551288],
      [27.2990750165721, 7.38905609893065, -199.714396746367],
      [0.00123937608833318, 20.0855369231877, 2.97510646581607],
      [0.00336897349954273, 20.0855369231877, 2.9323323583817],
      [0.00915781944436709, 20.0855369231877, 2.81606027941428],
      [0.024893534183932, 20.0855369231877, 2.5],
      [0.0676676416183064, 20.0855369231877, 1.64085908577048],
      [0.183939720585721, 20.0855369231877, -0.694528049465326],
      [             0.5, 20.0855369231877, -7.04276846159385],
      [1.35914091422952, 20.0855369231877, -24.2990750165721],
      [3.69452804946532, 20.0855369231877, -71.2065795512883],
      [10.0427684615938, 20.0855369231877, -198.714396746367],
      [27.2990750165721, 20.0855369231877, -545.31657921423],
      [0.00123937608833318, 54.5981500331442, 3.93233235838169],
      [0.00336897349954273, 54.5981500331442, 3.81606027941428],
      [0.00915781944436709, 54.5981500331442, 3.5],
      [0.024893534183932, 54.5981500331442, 2.64085908577048],
      [0.0676676416183064, 54.5981500331442, 0.305471950534673],
      [0.183939720585721, 54.5981500331442, -6.04276846159382],
      [             0.5, 54.5981500331442, -23.2990750165721],
      [1.35914091422952, 54.5981500331442, -70.2065795512881],
      [3.69452804946532, 54.5981500331442, -197.714396746367],
      [10.0427684615938, 54.5981500331442, -544.316579214227],
      [27.2990750165721, 54.5981500331442, -1486.47899352086],
      [0.00123937608833318, 148.413159102577, 4.81606027941428],
      [0.00336897349954273, 148.413159102577, 4.5],
      [0.00915781944436709, 148.413159102577, 3.64085908577048],
      [0.024893534183932, 148.413159102577, 1.30547195053466],
      [0.0676676416183064, 148.413159102577, -5.04276846159387],
      [0.183939720585721, 148.413159102577, -22.2990750165722],
      [             0.5, 148.413159102577, -69.2065795512885],
      [1.35914091422952, 148.413159102577, -196.714396746368],
      [3.69452804946532, 148.413159102577, -543.31657921423],
      [10.0427684615938, 148.413159102577, -1485.47899352086],
      [27.2990750165721, 148.413159102577, -4046.5419637877],
      [0.00123937608833318, 403.428793492735, 5.5],
      [0.00336897349954273, 403.428793492735, 4.64085908577048],
      [0.00915781944436709, 403.428793492735, 2.30547195053468],
      [0.024893534183932, 403.428793492735, -4.04276846159384],
      [0.0676676416183064, 403.428793492735, -21.2990750165721],
      [0.183939720585721, 403.428793492735, -68.2065795512882],
      [             0.5, 403.428793492735, -195.714396746367],
      [1.35914091422952, 403.428793492735, -542.316579214228],
      [3.69452804946532, 403.428793492735, -1484.47899352086],
      [10.0427684615938, 403.428793492735, -4045.54196378768],
      [27.2990750165721, 403.428793492735, -11007.2328974033]
      ].forEach(function(tuple) {
         var x, a, logp, rlogp;
         x = tuple[0];
         a = tuple[1];
         rlogp = tuple[2];
         logp = main.dexp(a, true)(x);
         expect(utils.relativelyCloseTo(rlogp, logp, precision)).to.be.ok;
      });
   });

   it('pexp and qexp', function() {
      [
      [0.00123937608833318, 0.00247875217666636, -6.00000307210618],
      [0.00336897349954273, 0.00247875217666636, -6.00000835085039],
      [0.00915781944436709, 0.00247875217666636, -6.00002269996488],
      [0.024893534183932, 0.00247875217666636, -6.00006170490204],
      [0.0676676416183064, 0.00247875217666636, -6.00016773131395],
      [0.183939720585721, 0.00247875217666636, -6.00045594098278],
      [             0.5, 0.00247875217666636, -6.00123937608833],
      [1.35914091422952, 0.00247875217666636, -6.00336897349954],
      [3.69452804946532, 0.00247875217666636, -6.00915781944437],
      [10.0427684615938, 0.00247875217666636, -6.02489353418393],
      [27.2990750165721, 0.00247875217666636, -6.06766764161831],
      [0.00123937608833318, 0.00673794699908547, -5.0000083508504],
      [0.00336897349954273, 0.00673794699908547, -5.00002269996488],
      [0.00915781944436709, 0.00673794699908547, -5.00006170490204],
      [0.024893534183932, 0.00673794699908547, -5.00016773131395],
      [0.0676676416183064, 0.00673794699908547, -5.00045594098278],
      [0.183939720585721, 0.00673794699908547, -5.00123937608833],
      [             0.5, 0.00673794699908547, -5.00336897349954],
      [1.35914091422952, 0.00673794699908547, -5.00915781944437],
      [3.69452804946532, 0.00673794699908547, -5.02489353418393],
      [10.0427684615938, 0.00673794699908547, -5.06766764161831],
      [27.2990750165721, 0.00673794699908547, -5.18393972058572],
      [0.00123937608833318, 0.0183156388887342, -4.00002269996488],
      [0.00336897349954273, 0.0183156388887342, -4.00006170490204],
      [0.00915781944436709, 0.0183156388887342, -4.00016773131395],
      [0.024893534183932, 0.0183156388887342, -4.00045594098278],
      [0.0676676416183064, 0.0183156388887342, -4.00123937608833],
      [0.183939720585721, 0.0183156388887342, -4.00336897349954],
      [             0.5, 0.0183156388887342, -4.00915781944437],
      [1.35914091422952, 0.0183156388887342, -4.02489353418393],
      [3.69452804946532, 0.0183156388887342, -4.06766764161831],
      [10.0427684615938, 0.0183156388887342, -4.18393972058572],
      [27.2990750165721, 0.0183156388887342, -4.5],
      [0.00123937608833318, 0.0497870683678639, -3.00006170490204],
      [0.00336897349954273, 0.0497870683678639, -3.00016773131395],
      [0.00915781944436709, 0.0497870683678639, -3.00045594098278],
      [0.024893534183932, 0.0497870683678639, -3.00123937608833],
      [0.0676676416183064, 0.0497870683678639, -3.00336897349954],
      [0.183939720585721, 0.0497870683678639, -3.00915781944437],
      [             0.5, 0.0497870683678639, -3.02489353418393],
      [1.35914091422952, 0.0497870683678639, -3.06766764161831],
      [3.69452804946532, 0.0497870683678639, -3.18393972058572],
      [10.0427684615938, 0.0497870683678639, -3.5],
      [27.2990750165721, 0.0497870683678639, -4.35914091422952],
      [0.00123937608833318, 0.135335283236613, -2.00016773131395],
      [0.00336897349954273, 0.135335283236613, -2.00045594098277],
      [0.00915781944436709, 0.135335283236613, -2.00123937608833],
      [0.024893534183932, 0.135335283236613, -2.00336897349954],
      [0.0676676416183064, 0.135335283236613, -2.00915781944436],
      [0.183939720585721, 0.135335283236613, -2.02489353418393],
      [             0.5, 0.135335283236613, -2.0676676416183],
      [1.35914091422952, 0.135335283236613, -2.18393972058572],
      [3.69452804946532, 0.135335283236613, -2.5],
      [10.0427684615938, 0.135335283236613, -3.35914091422952],
      [27.2990750165721, 0.135335283236613, -5.69452804946533],
      [0.00123937608833318, 0.367879441171442, -1.00045594098278],
      [0.00336897349954273, 0.367879441171442, -1.00123937608833],
      [0.00915781944436709, 0.367879441171442, -1.00336897349954],
      [0.024893534183932, 0.367879441171442, -1.00915781944437],
      [0.0676676416183064, 0.367879441171442, -1.02489353418393],
      [0.183939720585721, 0.367879441171442, -1.06766764161831],
      [             0.5, 0.367879441171442, -1.18393972058572],
      [1.35914091422952, 0.367879441171442, -1.5],
      [3.69452804946532, 0.367879441171442, -2.35914091422952],
      [10.0427684615938, 0.367879441171442, -4.69452804946531],
      [27.2990750165721, 0.367879441171442, -11.0427684615938],
      [0.00123937608833318,                1, -0.00123937608833318],
      [0.00336897349954273,                1, -0.00336897349954273],
      [0.00915781944436709,                1, -0.00915781944436709],
      [0.024893534183932,                1, -0.024893534183932],
      [0.0676676416183064,                1, -0.0676676416183064],
      [0.183939720585721,                1, -0.183939720585721],
      [             0.5,                1, -0.5],
      [1.35914091422952,                1, -1.35914091422952],
      [3.69452804946532,                1, -3.69452804946532],
      [10.0427684615938,                1, -10.0427684615938],
      [27.2990750165721,                1, -27.2990750165721],
      [0.00123937608833318, 2.71828182845904, 0.996631026500455],
      [0.00336897349954273, 2.71828182845904, 0.990842180555631],
      [0.00915781944436709, 2.71828182845904, 0.975106465816066],
      [0.024893534183932, 2.71828182845904, 0.932332358381692],
      [0.0676676416183064, 2.71828182845904, 0.816060279414277],
      [0.183939720585721, 2.71828182845904, 0.499999999999999],
      [             0.5, 2.71828182845904, -0.359140914229522],
      [1.35914091422952, 2.71828182845904, -2.69452804946531],
      [3.69452804946532, 2.71828182845904, -9.0427684615938],
      [10.0427684615938, 2.71828182845904, -26.299075016572],
      [27.2990750165721, 2.71828182845904, -73.2065795512881],
      [0.00123937608833318, 7.38905609893065, 1.99084218055563],
      [0.00336897349954273, 7.38905609893065, 1.97510646581607],
      [0.00915781944436709, 7.38905609893065, 1.93233235838169],
      [0.024893534183932, 7.38905609893065, 1.81606027941428],
      [0.0676676416183064, 7.38905609893065, 1.5],
      [0.183939720585721, 7.38905609893065, 0.640859085770479],
      [             0.5, 7.38905609893065, -1.69452804946532],
      [1.35914091422952, 7.38905609893065, -8.04276846159381],
      [3.69452804946532, 7.38905609893065, -25.2990750165721],
      [10.0427684615938, 7.38905609893065, -72.206579551288],
      [27.2990750165721, 7.38905609893065, -199.714396746367],
      [0.00123937608833318, 20.0855369231877, 2.97510646581607],
      [0.00336897349954273, 20.0855369231877, 2.9323323583817],
      [0.00915781944436709, 20.0855369231877, 2.81606027941428],
      [0.024893534183932, 20.0855369231877, 2.5],
      [0.0676676416183064, 20.0855369231877, 1.64085908577048],
      [0.183939720585721, 20.0855369231877, -0.694528049465326],
      [             0.5, 20.0855369231877, -7.04276846159385],
      [1.35914091422952, 20.0855369231877, -24.2990750165721],
      [3.69452804946532, 20.0855369231877, -71.2065795512883],
      [10.0427684615938, 20.0855369231877, -198.714396746367],
      [27.2990750165721, 20.0855369231877, -545.31657921423],
      [0.00123937608833318, 54.5981500331442, 3.93233235838169],
      [0.00336897349954273, 54.5981500331442, 3.81606027941428],
      [0.00915781944436709, 54.5981500331442, 3.5],
      [0.024893534183932, 54.5981500331442, 2.64085908577048],
      [0.0676676416183064, 54.5981500331442, 0.305471950534673],
      [0.183939720585721, 54.5981500331442, -6.04276846159382],
      [             0.5, 54.5981500331442, -23.2990750165721],
      [1.35914091422952, 54.5981500331442, -70.2065795512881],
      [3.69452804946532, 54.5981500331442, -197.714396746367],
      [10.0427684615938, 54.5981500331442, -544.316579214227],
      [27.2990750165721, 54.5981500331442, -1486.47899352086],
      [0.00123937608833318, 148.413159102577, 4.81606027941428],
      [0.00336897349954273, 148.413159102577, 4.5],
      [0.00915781944436709, 148.413159102577, 3.64085908577048],
      [0.024893534183932, 148.413159102577, 1.30547195053466],
      [0.0676676416183064, 148.413159102577, -5.04276846159387],
      [0.183939720585721, 148.413159102577, -22.2990750165722],
      [             0.5, 148.413159102577, -69.2065795512885],
      [1.35914091422952, 148.413159102577, -196.714396746368],
      [3.69452804946532, 148.413159102577, -543.31657921423],
      [10.0427684615938, 148.413159102577, -1485.47899352086],
      [27.2990750165721, 148.413159102577, -4046.5419637877],
      [0.00123937608833318, 403.428793492735, 5.5],
      [0.00336897349954273, 403.428793492735, 4.64085908577048],
      [0.00915781944436709, 403.428793492735, 2.30547195053468],
      [0.024893534183932, 403.428793492735, -4.04276846159384],
      [0.0676676416183064, 403.428793492735, -21.2990750165721],
      [0.183939720585721, 403.428793492735, -68.2065795512882],
      [             0.5, 403.428793492735, -195.714396746367],
      [1.35914091422952, 403.428793492735, -542.316579214228],
      [3.69452804946532, 403.428793492735, -1484.47899352086],
      [10.0427684615938, 403.428793492735, -4045.54196378768],
      [27.2990750165721, 403.428793492735, -11007.2328974033]
      ].forEach(function(tuple) {
         var x, a, logp, rlogp, rlogq, xfromqexp;
         x = tuple[0];
         a = tuple[1];
         rlogp = tuple[2];
         rlogq = tuple[3];
         logp = main.pexp(a, true, true)(x);
         // if (!utils.isEssentiallyZero(rlogp) && !utils.isEssentiallyZero(rlogq)) {
            expect(utils.relativelyCloseTo(rlogp, logp, precision)).to.be.ok;
            expect(utils.relativelyCloseTo(Math.exp(rlogp),
               main.pexp(a)(x), precision)).to.be.ok;
            expect(utils.relativelyCloseTo(rlogq,
               main.pexp(a, false, true)(x), precision)).to.be.ok;
            expect(utils.relativelyCloseTo(Math.exp(rlogq),
               main.pexp(a, false)(x), precision)).to.be.ok;
            xfromqexp = main.qexp(a, true, true)(logp);
            // console.log(tuple, logp, xfromqexp);
            expect(utils.relativelyCloseTo(xfromqexp, x, precision)).to.be.ok;
            xfromqexp = main.qexp(a, false, true)(rlogq);
            expect(utils.relativelyCloseTo(xfromqexp, x, precision)).to.be.ok;
         // }
      });
   });

   it('is also exported as an object', function() {
      var o;
      o = main.expdistr(.1);
      ['d', 'p', 'q', 'r'].forEach(function(s) {
         expect(o).to.respondTo(s);
         if (s !== 'r') {
            expect(o[s](.2)).to.equal(main[s + 'exp'](.1)(.2));
         }
      });
   });

});
